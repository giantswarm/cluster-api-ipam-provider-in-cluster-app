{{- if .Values.enabled }}
{{- with .Values.inClusterIpPool }}
{{- if .enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: in-cluster-ip-pool
  namespace: {{ $.Release.Namespace }}
  annotations:
    helm.sh/hook: "post-install,post-upgrade"
    helm.sh/hook-delete-policy: "before-hook-creation,hook-succeeded"
    helm.sh/hook-weight: "-2"
data:
  content: |
    apiVersion: ipam.cluster.x-k8s.io/v1alpha1
    kind: GlobalInClusterIPPool
    metadata:
      name: {{ .name }}
    spec:
      gateway: 0.0.0.0
      prefix: 24
    {{- if .start }}
      start: {{ .start }}
      end: {{ .end }}
    {{- else }}
      addresses:
      {{- range .addresses }}
      - {{ . }}
      {{- end }}
    {{- end }}
{{- end }}
{{- end }}
{{- end }}
